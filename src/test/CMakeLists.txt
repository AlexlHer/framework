add_executable(Neo.tests NeoBaseTest.cpp NeoEvolutiveMeshTest.cpp NeoPolyhedralMeshTest.cpp MeshView.cpp NeoMeshAPITest.cpp GraphTest.cpp)

target_include_directories(Neo.tests PUBLIC ../.)

find_package(GTest REQUIRED)
target_include_directories(Neo.tests PRIVATE ${GTEST_INCLUDE_DIRS})

find_package(Xdmf QUIET)

if(Xdmf_FOUND)
    target_link_libraries(Neo.tests ${XDMF_LIBNAME} ${XDMF_Xdmf_LIB_DEPENDS})
    target_compile_definitions(Neo.tests PRIVATE HAS_XDMF=1)
    target_include_directories(Neo.tests PUBLIC ${XDMF_INCLUDE_DIRS})
    message("-- XDMF Found ${XDMF_INCLUDE_DIRS}" )
endif(Xdmf_FOUND)

target_link_libraries(Neo.tests GTest::GTest GTest::Main Neo)

file( COPY meshes DESTINATION ${CMAKE_BINARY_DIR}/src/test)

include(GNUInstallDirs)

set(_exepath ${CMAKE_BINARY_DIR}/lib)
if (WIN32)
    set_target_properties(Neo.tests
            PROPERTIES
            RUNTIME_OUTPUT_DIRECTORY_DEBUG ${_exepath}
            RUNTIME_OUTPUT_DIRECTORY_RELEASE ${_exepath}
            RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO ${_exepath}
            )
else()
    set_target_properties(Neo.tests
            PROPERTIES
            RUNTIME_OUTPUT_DIRECTORY ${_exepath}
            )
endif()

gtest_discover_tests(Neo.tests)

